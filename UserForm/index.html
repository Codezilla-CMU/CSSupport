<!DOCTYPE html>
<html>

<head>
    <base target="_self">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>สถานะงาน จ้า</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.3.6/dist/sweetalert2.min.css">
    <style>
       input[type=text],
        select,
        textarea {
            width: 100%;
            padding: 12px 20px;
            margin: 8px 0;
            display: inline-block;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }
    </style>
</head>

<body>
    <div class="box-gray">
        <input type="text" id="userId" value="<?= userId ?>" style="display:none">
        <label for="request">รหัสงาน</label>
        <select id="problem_id_Select">

        </select>

        <label for="request">วันที่เเจ้ง</label>
        <input type="text" id="receiveDate" value="<?= receiveDate ?>" readonly placeholder="วันที่เเจ้ง...">

        <label for="displayName">ผู้แจ้ง</label>
        <input type="text" id="userName" value="<?= userName ?>" readonly placeholder="ผู้แจ้ง...">

        <label for="request">เรื่องที่แจ้ง</label>
        <input type="text" id="request" value="<?= request ?>" readonly placeholder="เรื่องที่แจ้ง...">

        <label for="request">สถานที่</label>
        <input type="text" id="location" value="<?= location ?>" readonly placeholder="สถานที่...">

        <label for="request">รูปประกอบ</label></br></br>
        <img id="problemPicture" src="<?= problemPicture ?>"width="200" height="350"/>
        
    </div>
    <script>
        var problemList = <?= JSON.stringify(problemList) ?>;
        var pList = JSON.parse(problemList);
        const optionSelect = document.getElementById("problem_id_Select");

          for (let i = 0; i < pList.length; i++) {
              const option = document.createElement("option");
              option.value = pList[i];
              option.textContent = pList[i];
              optionSelect.appendChild(option);
          }

        const requestValue = document.getElementById("request");
        const receiveDateValue = document.getElementById("receiveDate");
        const userNameValue = document.getElementById("userName");
        const locationValue = document.getElementById("location");
        const problemPictureValue = document.getElementById("problemPicture");
        google.script.run.withSuccessHandler(displayProblem).findProblem(pList[0])
        function displayProblem(jsonData) {
            var getproblemData = JSON.stringify(jsonData)
            var parsegetproblemData = JSON.parse(getproblemData)
            var request = parsegetproblemData[0].request
            requestValue.value = request

            var receiveDate = parsegetproblemData[0].receiveDate
            receiveDateValue.value = receiveDate

            var location = parsegetproblemData[0].location
            locationValue.value = location

            var problemPicture = parsegetproblemData[0].problemPicture
            problemPictureValue.src = problemPicture

            google.script.run.withSuccessHandler(displayPerson).findPerson(parsegetproblemData[0].owner)
            function displayPerson(jsonData) {
                var getpersonData = JSON.stringify(jsonData)
                var parsegetpersonData = JSON.parse(getpersonData)
                var name = parsegetpersonData[0].name
                userNameValue.value = name
            }
        }

        optionSelect.addEventListener("change", function() {
            problemPictureValue.src = ""
            const selectedOption = optionSelect.options[optionSelect.selectedIndex];
            const selectedOroblemId = selectedOption.value;
            google.script.run.withSuccessHandler(displayProblem).findProblem(selectedOroblemId)
            function displayProblem(jsonData) {
                var getproblemData = JSON.stringify(jsonData)
                var parsegetproblemData = JSON.parse(getproblemData)
                var request = parsegetproblemData[0].request
                requestValue.value = request

                var receiveDate = parsegetproblemData[0].receiveDate
                receiveDateValue.value = receiveDate

                var location = parsegetproblemData[0].location
                locationValue.value = location

                var problemPicture = parsegetproblemData[0].problemPicture
                problemPictureValue.src = problemPicture

                google.script.run.withSuccessHandler(displayPerson).findPerson(parsegetproblemData[0].owner)
                function displayPerson(jsonData) {
                    var getpersonData = JSON.stringify(jsonData)
                    var parsegetpersonData = JSON.parse(getpersonData)
                    var name = parsegetpersonData[0].name
                    userNameValue.value = name
                }
            }
        });
    </script>
    


       
        
</body>

</html>